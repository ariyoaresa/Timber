{{ 'jquery.simplemodal.js' | asset_url | script_tag }}
{{ 'http://ajax.microsoft.com/ajax/jquery.templates/beta1/jquery.tmpl.min.js' | script_tag }}
{{ 'jquery.products.min.js' | asset_url | script_tag }}
{{ 'wishlist.js' | asset_url | script_tag }}

<script type="text/javascript">

    var shopPermanentDomain = '{{shop.permanent_domain}}';
    var wishlistSettingRedirectUser = '{{ shop.metafields.wishlist_settings.wishlist_redirect }}';
    var linkWishlist = '{{pages.wishlist.url}}';
    var customerId = '{{customer.id}}';
    var wishlistSettingAddButton = !! '{{ shop.metafields.wishlist_settings.wishlist_add_button }}';
    var shopPermenantDomain = '{{shop.permanent_domain}}';
    var shopDomain = '{{shop.domain}}';

    var appDomain = 'http://wishlist.shopfrogs.com/wishlist/call/';
    var userId = 0;
    var customerFN='';
    var customerLN='';
    var wishlistSettingCustomerCheckout = !! {{ shop.metafields.wishlist_settings.wishlist_customer_checkout }};
    var customer = '{{customer.id}}';
    var productId = 0;
    var currency = "{{shop.money_format | strip_html}}";

    //My Wishlist Link
    if (wishlistSettingCustomerCheckout && customerId == '') {
        linkWishlist = '/account';
    }

    var linkElement = jQuery('<a>').attr({
        'id': 'my-wishlist-count',
        'href': linkWishlist
    }).html('My Wishlist'); 

    if (jQuery('#wishlist-link').length > 0) {
        jQuery('#wishlist-link').append(linkElement);
    } else {
        if (jQuery("li.cart-link").length > 0) {
            var li = jQuery('<li>').attr({
                'id': 'wishlist-link'
            });
            li.append(linkElement);
            jQuery("li.cart-link").before(li);
        }
    }

    //Product Page
    var buttonElementProduct = jQuery('<input />').attr({
        'class': 'add-to-wishlist-btn',
        'type': 'button',
        'name': '{{product.id}}',
        'id': 'add-to-wishlist',
        'value': 'Add to Wishlist',
        'rel': '{{product.handle}}'
    });

    if (jQuery('#p-wishlist-product').length > 0) {
        jQuery('#p-wishlist-product').append(buttonElementProduct);
    } else {
        if (jQuery("form#product-actions").length > 0) {
            var pElementProduct = jQuery('<p>').attr({
                'class': 'p-float',
                'id': 'p-wishlist-product'
            });
            jQuery("form#product-actions").after(pElementProduct);
            jQuery(pElementProduct).append(buttonElementProduct);
        }
    }

    //Other Page
    var buttonElement = jQuery('<input />').attr({
        'class': 'add-to-wishlist-btn-image',
        'type': 'button',
        'name': 'wishlist',
        'id': 'add-to-wishlist',
        'value': '',
        'title': 'Add to Wishlist'
    });

    if (wishlistSettingAddButton) {
        if (jQuery('p#p-wishlist').length > 0) {
            jQuery('p#p-wishlist').append(buttonElement);
        } else {
            if (jQuery("div.product-information").length > 0) {
                var pElement = jQuery('<p>').attr({
                    'class': 'p-float',
                    'id': 'p-wishlist',
                });
                jQuery("div.product-information").prepend(pElement);
                jQuery("p#p-wishlist").append(buttonElement);
            }
        }
    }

    // Load dialog on click
    jQuery(function ($) {
        $('input#add-to-wishlist').click(function (e) {

            if (wishlistSettingCustomerCheckout && customer == '') {
                window.location = '/account/login';
            } else {

                if ($(this).attr('name') == 'wishlist') {
                    productId = $(this).prev().val();
                    productHandle = $(this).prev().attr('id');
                } else {
                    productId = $(this).attr('name');
                    productHandle = $(this).attr('rel');
                }

                $('input#productId').val(productId);
                $('input#productId').attr('class', productHandle);
                loadCategories(userId, $('div#categories'), 0);
            }
            return false;
        });
    });

    if (wishlistSettingCustomerCheckout == false) {
        userId = getCookie('questId');
        customerFN = '';
        customerLN = 'Guest';

        if (!userId) {
            var domain = shopPermenantDomain;
            $.getJSON(
                appDomain + "cookie?format=json&shop="+domain+"&jsoncallback=?",
                function(data){
                    var today = new Date();
                    var days = 365*2; //Two year
                    today.setTime(today.getTime()+(days*24*60*60*1000));
                    setCookie('questId', data.id, today, '/', shopDomain);
		    userId = getCookie('questId');
                }
            );
        }
    } else {
        userId = '{{ customer.id }}';
        customerFN = '{{ customer.first_name }}';
        customerLN = '{{ customer.last_name }}';
    }


</script>

<div id="basic-modal-content">
  <h2>Please select a wishlist category</h2>
  
  <form class="select-form" onsubmit="javascript: return true;" accept-charset="utf-8" method="post" action="cart.php">
    <input type="hidden" value="0" id="productId" class="" />
    <div id="categories"></div>
    <table class="category_wishlist">
      <tr>
        <td width="40%">
          <input id="category-new" type="radio" size="45" value="0" name="category">
          <b><label for="category-new">or create a new wishlist</label></b>
        </td>
        <td>
          <input id="category-name" type="text" size="45" name="categoryName">
        </td>
      </tr>
      <tr>
        <td>
          <input onclick="addToWishlist()" class="add-to-wishlist-btn" type="button" name="add-wishlist" value="Add to Wishlist" />
        </td>
        <td>
          <span id="resultMessage"></span>
        </td>
      </tr>
    </table>
  </form>
  <div id="images">
  </div>
</div>
<div class="wl_loading"></div>
